# WiiLink WFC Docker

This is a guide for running a self-hosted instance of [WiiLink WFC](https://github.com/WiiLink24/wfc-server) across the internet.

> [!WARNING]
> This requires opening ports up to the internet! Use caution when exposing your machine to the internet!

> [!WARNING]
> This guide requires the usage of shell commands! Use caution when copying and pasting commands off of the internet! 

## Requirements
- Docker or Podman
- Your own domain
- CNAME records for your domain for the following subdomains:
    - www
    - nas
    - naswii
    - dls1
    - conntest
    - *.gs
- Opened the following inbound TCP ports:
    - 80
    - 443
    - 27900
    - 27901
    - 28910
    - 29900
    - 29901
    - 29920
    - 29998
    - 29999
- Opened the inbound UDP port range 2-65535

## Steps

1. Clone this repository and enter the directory

```
git clone --recurse-submodules https://github.com/CharlieQLe/wiilink-wfc-docker.git
cd wiilink-wfc-docker
```

2. Copy the included `config_example.xml` to `config.xml`

```
cp config_example.xml config.xml
```

3. Change the database password in `docker-compose.yml` and `config.xml` to a password of your choice. 

> [!WARNING]
> It is highly recommended to change the database password to one of your own and to store the password within a secrets manager!

4. (Podman users only) Podman users should append `:z` to `./config.xml:/app/config.xml` and `./wfc-server/schema.sql:/docker-entrypoint-initdb.d/schema.sql` to avoid any SELinux issues

5. Set `WFC_DOMAIN` in `docker-compose.yml` to your domain

6. Build and run the containers

```
docker compose up --build
```

## Retrieving the codes

In order to connect to your new server, your game must be patched with a gecko code generated by this docker container. For example, 

```
docker cp wiilink-wfc-docker_wfc_1:/app/codes ./codes
```

would copy the generated codes from the running container named `wiilink-wfc-docker_wfc_1` to the local directory `codes`. Use the appropriate code for your game.

## Notes

- LAN-only play should be possible, but it is untested
- This *should* work on real hardware, but it is untested

## Credits

- Vega for his guide [here](https://mariokartwii.com/showthread.php?tid=2419)
- The WiiLink project for creating an open source WFC server and patcher